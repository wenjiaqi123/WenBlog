# 查询

## 准备

### 员工表

```mysql
drop table if exists emp;

create table emp
(
    empno    int           null comment '员工编号',
    ename    varchar(50)   null comment '员工名称',
    job      varchar(50)   null comment '职位',
    mgr      int           null comment '部门主管编号',
    hiredate date          null comment '入职日期',
    sal      decimal(7, 2) null comment '薪水',
    comm     decimal(7, 2) null comment '佣金',
    deptno   int           null comment '部门编号'
);
```

```mysql
INSERT INTO emp (`empno`, `ename`, `job`, `mgr`, `hiredate`, `sal`, `comm`, `deptno`)
VALUES (7369, 'SMITH', 'CLERK', 7902, '1980-12-17', 800.00, NULL, 20),
       (7499, 'ALLEN', 'SALESMAN', 7698, '1981-02-20', 1600.00, 300.00, 30),
       (7521, 'WARD', 'SALESMAN', 7698, '1981-02-22', 1250.00, 500.00, 30),
       (7566, 'JONES', 'MANAGER', 7839, '1981-04-02', 2975.00, NULL, 20),
       (7654, 'MARTIN', 'SALESMAN', 7698, '1981-09-28', 1250.00, 1400.00, 30),
       (7698, 'BLAKE', 'MANAGER', 7839, '1981-05-01', 2850.00, NULL, 30),
       (7782, 'CLARK', 'MANAGER', 7839, '1981-06-09', 2450.00, NULL, 10),
       (7788, 'SCOTT', 'ANALYST', 7566, '1987-04-19', 3000.00, NULL, 20),
       (7839, 'KING', 'PRESIDENT', NULL, '1981-11-17', 5000.00, NULL, 10),
       (7844, 'TURNER', 'SALESMAN', 7698, '1981-09-08', 1500.00, 0.00, 30),
       (7876, 'ADAMS', 'CLERK', 7788, '1987-05-23', 1100.00, NULL, 20),
       (7900, 'JAMES', 'CLERK', 7698, '1981-12-03', 950.00, NULL, 30),
       (7902, 'FORD', 'ANALYST', 7566, '1981-12-03', 3000.00, NULL, 20),
       (7934, 'MILLER', 'CLERK', 7782, '1982-01-23', 1300.00, NULL, 10),
       (7981, 'MILLER', 'CLERK', 7788, '1992-01-23', 2600.00, 500.00, 20);
```

![image-20220712210905072](https://attach.blog.wen7.online/20220712210905.png)



### 部门表

```mysql
drop table if exists dept;

create table dept
(
    deptno int         null comment '部门编号',
    dname  varchar(14) null comment '部门名称',
    loc    varchar(13) null comment '地理位置'
);
```

```mysql
INSERT INTO dept (`deptno`, `dname`, `loc`)
VALUES (10, 'ACCOUNTING', 'NEW YORK'),
       (20, 'RESEARCH', 'DALLAS'),
       (30, 'SALES', 'CHICAGO'),
       (40, 'OPERATIONS', 'BOSTON');
```

![image-20220712213154023](https://attach.blog.wen7.online/20220712213154.png)



### 薪资等级表

```mysql
drop table if exists salgrade;

create table salgrade
(
    grade int(10) null comment '薪资等级',
    losal int(10) null comment '此等级最低工资',
    hisal int(10) null comment '此等级最高工资'
);
```

```mysql
INSERT INTO salgrade (`grade`, `losal`, `hisal`)
VALUES (1, 700, 1200),
       (2, 1201, 1400),
       (3, 1401, 2000),
       (4, 2001, 3000),
       (5, 3001, 9999); 
```

![image-20220712212350305](https://attach.blog.wen7.online/20220712212350.png)



### bonus 表

```mysql
drop table if exists bonus;

create table bonus
(
    ename varchar(10)   null comment '员工名称',
    job   varchar(9)    null comment '职位',
    sal   decimal(7, 2) null comment '薪水',
    comm  decimal(7, 2) null comment '佣金'
);
```

![image-20220712213630877](https://attach.blog.wen7.online/20220712213630.png)



## select

### 无子句

```mysql
select 100;
select 2+5,3*2;
```

![image-20220712203840120](https://attach.blog.wen7.online/20220712203840.png)![image-20220712203855194](https://attach.blog.wen7.online/20220712203855.png)

- 可以单独使用 select 子句，但是一般不会这么使用



## from

### dual 虚表（伪表）

```mysql
select 100
from dual;

select 2+5,3*2
from dual;
```

- dual 虚表



### 别名

```mysql
select 2+5 和,3*2 积
from dual;
```

```mysql
select 2+5 as sum,3*2 as mul
from dual;
```

![image-20220712211301757](https://attach.blog.wen7.online/20220712211301.png)![image-20220712211546796](https://attach.blog.wen7.online/20220712211546.png)

- 在查询字段后面加上别名
- ~~别名可以使用双引号引起来，如果别名中间有空格，就一定要使用双引号包裹，别名中一般不要使用空格~~
	- 标准语法是使用双引号，~~MySQL 也可使用单引号~~
- 也可使用 as 再加上别名（推荐使用 as）



### 查询所有

```mysql
select *
from 表名;
```

- ```mysql
  select *
  from emp;
  ```

- ![image-20220712214352231](https://attach.blog.wen7.online/20220712214609.png)

- 从 emp 表中查询所有的信息，* 号表示所有列，但是最好不要使用 * ，效率不高



### 查询多列

```mysql
select 列名1,列名2...
from 表名;
```

- ```mysql
	select t.empno,t.ename
	from emp as t;
	```
	
- ![image-20220712214601229](https://attach.blog.wen7.online/20220712214601.png)

- 每一列中间加上逗号，最后一个不加

- 表也可以使用别名，但是表的别名一般不加 as



### 去重查询

```mysql
select distinct 列名
from 表名;
```

- ```mysql
	select distinct deptno
	from emp;
	```
	
- ![image-20220712215034830](https://attach.blog.wen7.online/20220712215034.png)

- **distinct 只能放在查询字段最前面**

	- ![image-20220712215420543](https://attach.blog.wen7.online/20220712215420.png)

- ==应用于所有列==，而不仅仅是前置它的列

	- ![image-20220712215527249](https://attach.blog.wen7.online/20220712215527.png)




### 着重号

假设有一张表 sys_user，其中有一列的名称为 order，表示学生排名

![image-20220712222829691](https://attach.blog.wen7.online/20220712222829.png)

```mysql
-- 错误,order 是关键字
select id, u_name,order
from sys_user;

-- 正确,order 加上着重号
select id, u_name,`order` 
from sys_user;
```

![image-20220712222000597](https://attach.blog.wen7.online/20220712222000.png)

==在创建表的时，字段名，表名要注意避开这些关键字==



## where

```mysql
select 字段名
from 表名
where 过滤条件;
```

- ```mysql
  -- 查询部门编号为 10 的所有员工信息
  select *
  from emp
  where deptno = 10;
  ```

- ![image-20220713013538093](https://attach.blog.wen7.online/20220713013538.png)

- ```mysql
	-- 查询雇员名称为 KING 的员工
	select *
	from emp
	where ename = 'KING';
	```

	![image-20220713013710169](https://attach.blog.wen7.online/20220713013710.png)

	- 虽然 KING 和 king 都能查询出来，但这是属于 MySQL 的一处（个人认为是不合理的地方），在 Oracle 数据库是查不出来的。KING ≠ king



### 运算符

#### 算术运算符

| 算术运算符 | 其他写法 | 名称       | 作用       | 示例                                                 | 说明         |
| :--------- | -------- | ---------- | ---------- | ---------------------------------------------------- | ------------ |
| +          |          | 加法运算符 | 两个数相加 | select A+B  from dual;                               |              |
| -          |          | 减法运算符 | 两个数相减 | select A-B  from dual;                               |              |
| *          |          | 乘法运算符 | 两个数相乘 | select A*B from dual;                                |              |
| /          | div      | 除法运算符 | 两个数相除 | select A/B from dual;<br />select A div B from dual; | 一般只使用 / |
| %          | mod      | 取余运算符 | 两个数取余 | select A%B from dual;<br />select A mod B from dual; | 一般只适用 % |

##### 加法减法运算符

- 整数与整数的结果还是整数，整数与浮点数的结果是浮点数

![image-20220713015436344](https://attach.blog.wen7.online/20220713015436.png)



- 在 Java，JavaScript 等编程语言中，加号左右如果有字符，表示字符串拼接，但是 MySQL 不是。只表示数值相加，而且会将字符串从前向后解析出数值，相加，转换失败按照 0 计算

![image-20220713015759492](https://attach.blog.wen7.online/20220713015759.png)![image-20220713015816450](https://attach.blog.wen7.online/20220713015816.png)![image-20220713015832322](https://attach.blog.wen7.online/20220713015832.png)



##### 乘法除法运算符

- ![image-20220713020723409](https://attach.blog.wen7.online/20220713020723.png)



##### 取模运算符

![image-20220713021135701](https://attach.blog.wen7.online/20220713021135.png)



#### 比较运算符

| 算术运算符 | 其他写法 | 名称     | 说明                       |
| :--------- | -------- | -------- | -------------------------- |
| >          |          | 大于     |                            |
| <          |          | 小于     |                            |
| >=         |          | 大于等于 |                            |
| <=         |          | 小于等于 |                            |
| =          |          | 等于     | 两边有 null，结果就为 null |
| <=>        |          | 安全等于 | 解决 null 的比较问题       |
| !=         | <>       | 不等于   | 两边有 null，结果就为 null |

##### 等号运算符

结果为 true，显示 1，结果为 false，显示 0

- 如果等号两遍都是数值，按照大小
- 如果等号两遍都是字符串，按照字符串比较
- 如果一边是数值，一边是字符串，字符串尝试转换成数值，转换失败会当成 0，再进行数值比较
- 等号两边如果出现 NULL，结果为 NULL

![image-20220713022843123](https://attach.blog.wen7.online/20220713022843.png)



##### 安全等于

- 和 = 唯一的区别，就是 null 值的判断

![image-20220713024943778](https://attach.blog.wen7.online/20220713024943.png)



如果使用 comm = null，会发现没有数据，因为每一条的 comm 和 null 比较的结果都是 null，不显示，只有比较结果 = 1 的才会被展示出来，所以当使用安全比较的时候，comm <=> null，如果 comm 的值为 null，比较结果就为 1，就会展示出来

![image-20220713025300788](https://attach.blog.wen7.online/20220713025300.png)



#### 比较关键字

| 运算符              | 名称             | 作用                               | 示例                                              |
| ------------------- | ---------------- | ---------------------------------- | ------------------------------------------------- |
| is null             | 为空运算符       | 判断值，字符串是为空               | select * from emp where comm is null              |
| is not null         | 不为空运算符     | 判断值，字符串是不为空             | select * from emp where comm is not null          |
| isnull（）          | 为空函数         | 判断值，字符串是为空               | select * from emp where isnull(comm)              |
|                     |                  |                                    |                                                   |
| least（）           | 最小值函数       | 求多个值中最小值                   | select least(1,2,3,4) from dual                   |
| greatest（）        | 最大值函数       | 求多个值中最大值                   | select greatest(1,2,3,4) from dual                |
|                     |                  |                                    |                                                   |
| between ... and ... | 两值之间运算符   | 判断一个值是否在两个值之间         | select * from emp where sal between 1000 and 2000 |
| in（）              | 属于运算符       | 判断一个值是否在该列表中           | select * from emp where deptno in (10,20)         |
| not in（）          | 不属于运算符     | 判断一个值是否不在该列表中         | select * from emp where deptno not in (10,20)     |
|                     |                  |                                    |                                                   |
| like                | 模糊匹配运算符   | 判断一个值是否符合模糊匹配规则     |                                                   |
| regexp              | 正则表达式运算符 | 判断一个值是否符合正则表达式的规则 |                                                   |
| rlike               | 正则表达式运算符 | 判断一个值是否符合正则表达式的规则 |                                                   |



##### 空值判断

<img src="https://attach.blog.wen7.online/20220713185459.png" alt="image-20220713185459716" style="zoom: 40%;" /><img src="https://attach.blog.wen7.online/20220713185527.png" alt="image-20220713185527392" style="zoom:40%;" />

<img src="https://attach.blog.wen7.online/20220713185627.png" alt="image-20220713185627499" style="zoom:50%;" />



##### 最值

<img src="https://attach.blog.wen7.online/20220713190044.png" alt="image-20220713190044532" style="zoom:80%;" />



##### 区间

<img src="https://attach.blog.wen7.online/20220713190259.png" alt="image-20220713190259927" style="zoom:80%;" />

<img src="https://attach.blog.wen7.online/20220713190336.png" alt="image-20220713190336648" style="zoom:42%;" /><img src="https://attach.blog.wen7.online/20220713190401.png" alt="image-20220713190401347" style="zoom:42%;" />



##### 规则匹配

- 直接 like 'S' ，表示 ename = S 的数据，显然没有【下图中使用 S 的案例并不好，但是博主已经写完文档了，大家可以使用字符 K 查看效果】

- % 代表 n 个字符，n的取值为 ≥0 的整数

	- '%S' 表示 S 前面有 n 个字符，可能是 S，可能是 AS，可能是 ABCS，简单来说，以 S 结尾
	- 'S%' 表示 S 后面有 n 个字符，可能是 S，可能是 SA，可能是 SABC，简单来说，以 S 开头
	- '%S%'  表示 S 前后有 n 个字符，简单来说，只要字符里包含 S 即可

- _ 代表1个字符，使用的场景不多，没有 % 用的多

	- _K 表示第二个字符是 K 的字符串
	- \_K\_ 表示一共三个字符，中间一个为 K 的字符串

- 转义字符 \

	- 比如我想查询第二个字符是 _ 的字符串，where ename like '\_\\\_'；第一个 _ 表示1个字符，第二个 _ 前面使用了 \ 转义成 _

	- ```mysql
		select *
		from emp
		where ename like '__';		--	可以匹配 aa,bb,a_,b_
		where ename like '_\_';		--  可以匹配 a_,b_
		```

- ~~临时转义~~ 

	- 如果想要指定某个字符为转义字符，需要使用 escape

	- ```mysql
		select *
		from emp
		where ename like '_$_' escape '$';		--  指定 $ 为转义字符,即现在 $ 拥有和 \ 一样的功能
		```

- 正则匹配

	- 需要了解正则表达式

	- ```
		‘^’匹配以该字符后面的字符开头的字符串。
		‘$’匹配以该字符前面的字符结尾的字符串。
		‘.’匹配任何一个单字符。
		“[...]”匹配在方括号内的任何字符。例如，“[abc]”匹配“a”或“b”或“c”。为了命名字符的范围，使用一 个‘-’。“[a-z]”匹配任何字母，而“[0-9]”匹配任何数字。
		‘*’匹配零个或多个在它前面的字符。例如，“x*”匹配任何数量的‘x’字符，“[0-9]*”匹配任何数量的数字， 而“*”匹配任何数量的任何字符。
		```

	- ```mysql
		select * from emp
		where ename regexp '^S';		-- 查询 ename 符合正则表达式 '^S' (以S开头)的数据
		
		select * from emp
		where ename regexp 'S$';		-- 查询 ename 符合正则表达式 'S$' (以S结尾)的数据
		```

![image-20220713192153818](https://attach.blog.wen7.online/20220713192153.png)

<img src="https://attach.blog.wen7.online/20220713192716.png" style="zoom:80%;" /><img src="https://attach.blog.wen7.online/20220713192747.png" alt="image-20220713192747119" style="zoom:80%;" /><img src="https://attach.blog.wen7.online/20220713192640.png" alt="image-20220713192640793" style="zoom:80%;" />



![image-20220713205348567](https://attach.blog.wen7.online/20220713205348.png)



#### 逻辑运算符

| 运算符 | 其他写法 | 名称 | 作用                   | 示例 |
| ------ | -------- | ---- | ---------------------- | ---- |
| and    | &&       | 与   | 多个判断条件同时成立   |      |
| or     | \|\|     | 或   | 多个判断条件或者成立   |      |
| not    | !        | 非   | 判断条件取反           |      |
| xor    |          | 异或 | 2个条件，只能有1个满足 |      |

- 查找 emp 表中，工资 [1000,2000] 的员工信息

	- ```mysql
		select *
		from emp
		where sal between 1000 and 2000;
		```

	- ```mysql
		select *
		from emp
		where sal >= 1000 and sal <= 2000;	【比较多】
		where sal >= 1000 && sal <= 2000;
		```

- 查找 emp 表中，工资不在 [1000,2000] 的员工信息

	- ```mysql
		select *
		from emp
		where sal < 1000 or sal > 2000;		【比较多】
		where sal < 1000 || sal > 2000;
		```

- 查找 emp 表中，comm 是 null 的员工信息

	- ```mysql
		select *
		from emp
		where comm is null;		-- where comm = null;【写法错误】
		```

	- ```mysql
		select *
		from emp
		where comm <=> null;	-- 使用安全等于
		```

- 查找 emp 表中，comm 不是 null 的员工信息

	- ```mysql
		select * 
		from emp 
		where comm is not null;
		```

	- ```mysql
		select *
		from emp
		where not comm is null;		-- 对 comm is null 取反
		where not comm <=> null;	-- 对 comm is null 取反
		```

		- ```mysql
			-- 这种做法能够通过编译,运行,但是实际不会这么做的
			select *
			from emp
			where not comm is not null;		-- 对 comm is not null 取反,即查询 comm 为 null 的值 
			where not not not comm is not null;		-- 这种儍痹的做法,只要你自己不晕就行
			```

- 异或使用场景很少

	- ```mysql
		select *
		from emp
		where sal > 2000 xor deptno = 10;
		-- sal > 2000 和 deptno = 10 只能有一个满足
		```

	- ![image-20220713221641212](https://attach.blog.wen7.online/20220713221641.png)



#### ~~位运算符~~

| 运算符 | 名称 | 作用     | 示例 |
| ------ | ---- | -------- | ---- |
| &      | 位与 | 位与     |      |
| \|     | 位或 | 位或     |      |
| ^      | 异或 | 取反异或 |      |
| ~      | 取反 | 按位取反 |      |
| >>     | 右移 | 右移     |      |
| <<     | 左移 | 左移     |      |

![image-20220714100711538](https://attach.blog.wen7.online/image-20220714100711538.png)

- 默认是 8 字节
- 对 3 取反
    - <u>0000 0000</u>   <u>0000 0000</u>   <u>0000 0000</u>   <u>0000 0000</u>   <u>0000 0000</u>   <u>0000 0000</u>   <u>0000 0000</u>   <u>0000 0011</u>
    - <u>1111 1111</u>   <u>1111 1111</u>   <u>1111 1111</u>   <u>1111 1111</u>   <u>1111 1111</u>   <u>1111 1111</u>   <u>1111 1111</u>   <u>1111 1100</u> = (2^64^ -1) - 3



order by
---

```mysql
select *
from 表名
where 过滤条件
order by 排序字段
```

### 默认排序

```mysql
select *
from emp;
```

- 默认按照插入的顺序显示

![image-20220714130710990](https://attach.blog.wen7.online/image-20220714130710990.png)



### 指定排序

```mysql
select *
from emp
order by sal asc;		-- 按照薪水升序排序
order by sal desc;		-- 按照薪水降序排序
```

- 升序 asc（默认），降序 desc
    - 因为日常排序，我们都是 1，2，3... 这种顺序，默认升序


<img src="https://attach.blog.wen7.online/image-20220714131222985.png" alt="image-20220714131222985" style="zoom: 55%;" /><img src="https://attach.blog.wen7.online/image-20220714131241472.png" alt="image-20220714131241472" style="zoom:55%;" />



### 多字段排序

```mysql
select *
from emp
order by deptno, sal desc;			-- 先按照 deptno 升序排序,再按照 sal 降序		
```

- 在第一列相同的情况下，进行第二列的排序

![image-20220714131407563](https://attach.blog.wen7.online/image-20220714131407563.png)



### 指定顺序排序

#### 准备

```mysql
drop table if exists t_user;

create table t_user
(
    id    int         null comment '编号',
    name  varchar(10) null comment '姓名',
    score int         null comment '成绩'
);
```

```mysql
INSERT INTO t_user (`id`, `name`, `score`)
VALUES (1, '小刚', 89),
       (2, '小明', 95),
       (3, '小红', 94),
       (4, '小虎', 78);
```

![image-20220714160933827](https://attach.blog.wen7.online/image-20220714160933827.png)



#### order by

```mysql
select *
from t_user
order by score desc;
```

![image-20220714161119498](https://attach.blog.wen7.online/image-20220714161119498.png)





#### 自定义顺序

##### case when then end 

```mysql
select *
from t_user
order by case name
             when '小红' then 1
             when '小明' then 2
             when '小虎' then 3
             when '小刚' then 4
             end
        asc
```

![image-20220714161037881](https://attach.blog.wen7.online/image-20220714161037881.png)



##### field()

```mysql
select *
from t_user
order by field(name,'小红','小明','小虎','小刚') desc;
```

![image-20220714161454596](https://attach.blog.wen7.online/image-20220714161454596.png)



## limit

==limit 使用在 SQL 的最后一行==

```mysql
select *
from 表名
where 过滤条件
order by 排序字段
limit [偏移量,] 行数
```

### 1个参数

```mysql
-- 显示前 10 条数据
select *
from emp
limit 10;
```

![image-20220714170157353](https://attach.blog.wen7.online/image-20220714170157353.png)



### 2个参数

第一个参数表示，偏移量，可以省略，省略的话表示 0，省略的话就得到了上面 1 个参数的效果，就是前 10 条

第二个参数表示，记录数

```mysql
select *
from emp
order by sal desc
limit 0,5;			-- 第 0 条不算,之后的 5 条数据

select *
from emp
order by sal desc
limit 5,5;			-- 第 5 条不算,之后的 5 条数据

select *
from emp
order by sal desc
limit 10,5;			-- 第 10 条不算,之后的 5 条数据
```

![image-20220714171416721](https://attach.blog.wen7.online/image-20220714171416721.png)

<img src="https://attach.blog.wen7.online/image-20220714170936391.png" alt="image-20220714170936391" style="zoom: 33%;" /><img src="https://attach.blog.wen7.online/image-20220714171004943.png" alt="image-20220714171004943" style="zoom: 33%;" /><img src="https://attach.blog.wen7.online/image-20220714171021517.png" alt="image-20220714171021517" style="zoom: 33%;" />



### offset

```mysql
select *
from emp
order by sal desc
limit 5 offset 10;		-- 偏移量为10,之后的 5 条数据,等同于 limit 10,5
```

![image-20220714171831128](https://attach.blog.wen7.online/image-20220714171831128.png)



### 用途

==分页==

比如 QQ 空间的日志分页，我们不是一下子就加载全部的，而是一次加载 10 条，然后再加载第二页的 11-20 条

比如 微信朋友圈，打开女神的朋友圈，并不是一下子全部加载出来的，而是先加载 20 条，然后向下滑动到第 20 条，会有一个刷新的卡顿，再加载 20-40 条

比如 抖音也会有类似的分页

加载第 1 页的 10 条数据，`limit 0,10` 			

加载第 2 页的 10 条数据，`limit 10,10`

加载第 3 页的 10 条数据，`limit 20,10`

==limit  （ 当前页码 - 1 ）* 每页条数，每页条数==



### 方言

limit 并不是所有数据库都支持

- MySQL，PostgreSQL，MariaDB，SQLite 支持

- Oracle，DB2，SQL Server 等不支持



## 多表关联

### 前言

多表关联的情况

![image-20220719114821650](https://attach.blog.wen7.online/image-20220719114821650.png)

![image-20220719114831946](https://attach.blog.wen7.online/image-20220719114831946.png)

![image-20220719114840146](https://attach.blog.wen7.online/image-20220719114840146.png)

- 查询学生编号 = 3 的学生的班级编号

	- ```mysql
		select clazz_id
		from t_student
		where student_id = 3;		-- 结果为 203
		```

- 查询班级编号 = 203 的班主任编号

	- ```mysql
		select teacher_id
		from t_clazz
		where clazz_id = 203;		-- 结果为 1009
		```

- 查询教师编号 = 1009 的教师信息

	- ```mysql
		select *
		from t_teacher
		where teacher_id = 1009;	-- 结果为 1009,冯,女,英语,是
		```

	

如果我们查询学生编号 = 3 的学生的教师信息，我们需要查询三次，才能查出来。其中光是网络连接就连接了三次，如果我们能够一次性就查询出来，是不是很好呢？



### 笛卡尔积（交叉连接）

[百度百科 - 笛卡尔积](https://baike.baidu.com/item/%E7%AC%9B%E5%8D%A1%E5%B0%94%E4%B9%98%E7%A7%AF/6323173?fromtitle=%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF&fromid=1434391&fr=aladdin)

- 何为笛卡尔积？

	- 笛卡尔积是一个数学运算，由数学家 笛卡尔 提出

	- 有两个集合，X 和 Y，那么 X 和 Y 的所有可能的组合就是 笛卡尔积

	- $笛卡尔积的数量 = X 集合的数量  *  Y 集合的数量$

	- 假设集合 X（小明，小刚，小张），集合 Y（小红，小美）互相谈恋爱，有多少种可能

		- X = 3 ，Y = 2 ，笛卡尔积 = 3*2 = 6

		- | X 集合 | Y 集合 |
			| :----: | :----: |
			|  小明  |  小红  |
			|  小明  |  小美  |
			|        |        |
			|  小刚  |  小红  |
			|  小刚  |  小美  |
			|        |        |
			|  小张  |  小红  |
			|  小张  |  小美  |

			

#### 错误结果

```mysql
select *
from t_student,t_clazz;
```

下图是查询结果，为了方便观看，拷贝到了 Excel 中并调整了格式

![image-20220719123516672](https://attach.blog.wen7.online/image-20220719123516672.png)



#### 正确结果

加上关联条件

```mysql
select *
from t_student x,t_clazz y
where x.clazz_id = y.clazz_id
```

![image-20220719123909369](https://attach.blog.wen7.online/image-20220719123909369.png)

在 IntelliJ IDEA 或者 Navicat 等工具中，会对 * 有优化



### 重复列名

```mysql
select student_id, student_name, gender, age, clazz_id, address, score,
       clazz_id, clazz_name, teacher_id, total_size
from t_student x,t_clazz y
where x.clazz_id = y.clazz_id

-- Column 'clazz_id' in field list is ambiguous 【字段列表中的 “clazz_id” 列不明确】
```

![image-20220719124446645](https://attach.blog.wen7.online/image-20220719124446645.png)

因为 t_student 中有 clazz_id 的字段，t_clazz 中也有 clazz_id 字段

==多个表中有相同列时，必须在列名之前加上表名前缀==，**并且建议在所有字段前面都加上表名称**

![image-20220719124802653](https://attach.blog.wen7.online/image-20220719124802653.png)



### 表别名

可以给表起别名

```mysql
select t_student.student_id,
       t_student.student_name,
       t_student.gender,
       t_student.age,
       t_student.clazz_id,
       t_student.address,
       t_student.score,
       t_clazz.clazz_id,
       t_clazz.clazz_name,
       t_clazz.teacher_id,
       t_clazz.total_size
from t_student,
     t_clazz
where t_student.clazz_id = t_clazz.clazz_id
```

```mysql
select t1.student_id,
       t1.student_name,
       t1.gender,
       t1.age,
       t1.clazz_id,
       t1.address,
       t1.score,
       t2.clazz_id,
       t2.clazz_name,
       t2.teacher_id,
       t2.total_size
from t_student t1,
     t_clazz t2
where t1.clazz_id = t2.clazz_id
```

![image-20220719125337097](https://attach.blog.wen7.online/image-20220719125337097.png)



- 竖过来写的话看起来没什么感觉，但是如果将 select 查询的字段写成一行，就会很较大感官差别
- 表别名看公司规定，或者个人喜好
	- 可以 按照 t、t1、t2 这种命名
	- 可以按照 表名首字母缩写，例如:  sys_user 表的别名为 su，sys_user_role 表的别名为 sur





### 等值连接 和 非等值连接

#### 等值连接

连接条件是等值的（在工作中，绝大部分都是等值连接）



#### 非等值连接

```mysql
-- 查询员工编号,姓名,薪水,薪水等级
select t1.empno,
       t1.ename,
       t1.sal,
       t2.grade
from emp t1,salgrade t2
where t1.sal >= t2.losal and t1.sal <= t2.hisal
```

![image-20220719135514045](https://attach.blog.wen7.online/image-20220719135514045.png)



### 自连接 和 非自连接

#### 非自连接

相互关联的表不是同一张表



#### 自连接

表是一张表，逻辑关系上当成两张表

```mysql
-- 查询员工的编号,姓名,上级管理者编号,以及管理者的编号,姓名,上级管理者的编号
select t1.empno,t1.ename,t1.mgr,
       t2.empno,t2.ename,t2.mgr
from emp t1,emp t2
where t1.mgr = t2.empno
```

![image-20220719135840967](https://attach.blog.wen7.online/image-20220719135840967.png)



### 内连接 和 外连接

#### 前言

![image-20220719140746921](https://attach.blog.wen7.online/image-20220719140746921.png)

我们给员工表加上一行记录，wenc，部门编号是 50

- emp 表中的记录 wenc 的部门编号是 50，而 dept 表中是没有 50 的这个部门的
- dept 表中的记录部门编号为 40 的，但是没有员工的部门编号是 40 的



#### 内连接

现象：**只合并两张表中符合条件的行**，员工表的 wenc 没有查询出来，部门编号 = 40 的也没有出来

```mysql
select t1.*,t2.*
from emp t1,dept t2
where t1.deptno = t2.deptno
```

![image-20220719141505293](https://attach.blog.wen7.online/image-20220719141505293.png)



#### 外连接

除了符合条件的行，还有左表的值或右表的值

![image-20220719140746921](https://attach.blog.wen7.online/image-20220719140746921.png)

==将以上 emp 称为左表，dept 称为右表==



##### 左外连接

![image-20220719141901793](https://attach.blog.wen7.online/image-20220719141901793.png)

查出来 16 行，其中 wenc 的记录也被查询出来，但是由于右表 dept 中没有编号 = 50 的记录，所以值为空

==左外连接：左表的所有数据都会被查询出来，右表没有的值用 null 填充==



##### 右外连接

![image-20220719141927024](https://attach.blog.wen7.online/image-20220719141927024.png)

查出来 16 行，其中部门编号 = 40 的记录被查询出来，但是由于左表 emp 中没有 dept = 40 的员工记录，所以值为空

==右外连接：右表所有的数据都会被查询出来，左表没有的值用 null 填充==



##### 全外连接

将左表，右表所有的数据都查询出来，不符合连接条件的用 null 填充

![](https://attach.blog.wen7.online/image-20220719152251244.png)



##### 左右转换

==右外连接可以转换成左外连接==，左外连接也可以转换成右外连接

emp 是左表，dept 是右表，右外连接会将 dept 所有的记录都查询出来

把 dept 当成左表，emp 当成右表，左外连接会将左表 dept 所有的记录都查询出来

==需要将哪张表全部查询出来的，叫做主表，另外一张表叫做从表==

![image-20220719143541478](https://attach.blog.wen7.online/image-20220719143541478.png)



#### 92语法 和 99 语法

##### 92语法

==MySQL 不支持==



##### 99语法

###### 内连接

==inner  join==，inner 可以省略

```mysql
select t1.*, t2.*
from emp t1,dept t2
where t1.deptno = t2.deptno;								-- 不推荐
```

```mysql
select t1.*, t2.*
from emp t1
         join dept t2 on t1.deptno = t2.deptno;				-- 内连接
```

```mysql
select t1.*, t2.*
from emp t1
         inner join dept t2 on t1.deptno = t2.deptno;		-- inner 可以省略
```



###### 左外连接

==left outer join==，**outer 可以省略**

```mysql
select t1.*, t2.*
from emp t1
         left join dept t2 on t1.deptno = t2.deptno;
```

```mysql
-- 可以先在 student 表中加一条数据,但是班级是不存在的 210
select t1.*, t2.*,t3.*
from t_student t1
    left join t_clazz t2 on t1.clazz_id = t2.clazz_id;
    
select t1.*, t2.*,t3.*
from t_student t1
    left join t_clazz t2 on t1.clazz_id = t2.clazz_id
    left join t_teacher t3 on t2.teacher_id = t3.teacher_id;
```



###### 右外连接

==right outer join==，**outer 可以省略**

```mysql
select t1.*, t2.*
from emp t1
         right join dept t2 on t1.deptno = t2.deptno;		-- 右外连接以 dept 为主表
         
-- 等同于下方 SQL

select t1.*, t2.*
from dept t1
         left join emp t2 on t1.deptno = t2.deptno;			-- 以 dept 为主表,左外连接
```



###### 全外连接

==full outer join==，**outer 可以省略**，==MySQL 不支持全外连接==

**效果如下：** 可以使用 Oracle 尝试一下

![image-20220719152251244](https://attach.blog.wen7.online/image-20220719152251244.png)





### union all 和 union

将多个查询的结果集，纵向拼接

拼接时，列的类型和列的个数必须保持一致

#### union all（简单拼接）

```mysql
select t1.*, t2.*
from emp t1
         left join dept t2 on t1.deptno = t2.deptno

union all

select t1.*, t2.*
from emp t1
         right join dept t2 on t1.deptno = t2.deptno;
```



#### union（去重）

```mysql
select t1.*, t2.*
from emp t1
         left join dept t2 on t1.deptno = t2.deptno

union

select t1.*, t2.*
from emp t1
         right join dept t2 on t1.deptno = t2.deptno;
```

![image-20220719153313731](https://attach.blog.wen7.online/image-20220719153313731.png)



| 纬度 |          union           | ==union all== |
| :--: | :----------------------: | :-----------: |
| 去重 |           去重           |    不去重     |
| 排序 |           排序           |    不排序     |
| 效率 | 低（因为需要去重，排序） |     更高      |



### 交差并补

#### 图解

<img src="https://attach.blog.wen7.online/image-20220721173600545.png" alt="image-20220721173600545"  />



#### 左外连接，右外连接

```mysql
select a.empno,a.ename,a.job,a.mgr,a.hiredate,a.sal,a.comm,a.deptno,
       b.deptno,b.dname,b.loc
from emp a
         left join dept b on a.deptno = b.deptno
```

```mysql
select a.empno,a.ename,a.job,a.mgr,a.hiredate,a.sal,a.comm,a.deptno,
       b.deptno,b.dname,b.loc
from emp a
         right join dept b on a.deptno = b.deptno
```

![image-20220721165057441](https://attach.blog.wen7.online/image-20220721165057441.png)

![image-20220721165125088](https://attach.blog.wen7.online/image-20220721165125088.png)



#### 内连接（并集）

```mysql
select a.empno,a.ename,a.job,a.mgr,a.hiredate,a.sal,a.comm,a.deptno,
       b.deptno,b.dname,b.loc
from emp a
          join dept b on a.deptno = b.deptno;
```

![image-20220721165223839](https://attach.blog.wen7.online/image-20220721165223839.png)



#### A差B，B差A（差集）

```mysql
select a.empno,a.ename,a.job,a.mgr,a.hiredate,a.sal,a.comm,a.deptno,
       b.deptno,b.dname,b.loc
from emp a
    left join dept b on a.deptno = b.deptno
where b.deptno is null
```

```mysql
select a.empno,a.ename,a.job,a.mgr,a.hiredate,a.sal,a.comm,a.deptno,
       b.deptno,b.dname,b.loc
from emp a
    right join dept b on a.deptno = b.deptno
where a.deptno is null
```

![image-20220721170107950](https://attach.blog.wen7.online/image-20220721170107950.png)

![image-20220721170143614](https://attach.blog.wen7.online/image-20220721170143614.png)



#### 全外连接（交集）

```mysql
-- select a.empno,a.ename,a.job,a.mgr,a.hiredate,a.sal,a.comm,a.deptno,
--        b.deptno,b.dname,b.loc
-- from emp a
--        full join dept b on a.deptno = b.deptno;		-- MySQL 不支持全外连接,但其他数据库可能支持,例如 Oracle
```

- MySQL 交集可以使用 union 来拼接，拼接方案众多
	- `A+ union B+` 需要去重
	- `A- union all 交集 union all B-` 
	- `A+ union all B-` 或者 `B+ union all A-`

```mysql
select a.empno,a.ename,a.job,a.mgr,a.hiredate,a.sal,a.comm,a.deptno,
       b.deptno,b.dname,b.loc
from emp a left join dept b on a.deptno = b.deptno

union

select a.empno,a.ename,a.job,a.mgr,a.hiredate,a.sal,a.comm,a.deptno,
       b.deptno,b.dname,b.loc
from emp a right join dept b on a.deptno = b.deptno
```

![image-20220721165847196](https://attach.blog.wen7.online/image-20220721165847196.png)



#### （补集）

`A- union all B-`

```mysql
select a.empno,a.ename,a.job,a.mgr,a.hiredate,a.sal,a.comm,a.deptno,
       b.deptno,b.dname,b.loc
from emp a left join dept b on a.deptno = b.deptno
where b.deptno is null

union all

select a.empno,a.ename,a.job,a.mgr,a.hiredate,a.sal,a.comm,a.deptno,
       b.deptno,b.dname,b.loc
from emp a right join dept b on a.deptno = b.deptno
where a.deptno is null
```

![image-20220721170546223](https://attach.blog.wen7.online/image-20220721170546223.png)





### ~~自然连接 和 using~~

#### 自然连接

natural  join：将两张表中**字段相同**的，进行**等值连接**

- 不够灵活，不建议

```mysql
select a.*,b.*
from a
	join b on a.id = b.id and a.clazz_id = b.clazz_id;
```

```mysql
select a.*,b.*
from a
	natural join b;
```



#### using

- 优化了自然连接
- 还是有缺陷，必须两张表的字段相同

```mysql
select a.*,b.*
from a
	join b using(id);			-- 相当于 join b on a.id = b.id
--  join b using(clazz_id);		-- 相当于 join b on a.clazz_id = b.clazz_id
```



### 其他

> 《阿里巴巴开发手册》
>
> 【强制】超过三个表禁止 join。需要 join 的字段，数据类型保持绝对一致；多表关联查询时，保证被关联的字段需要有索引





## 单行函数

### 简介

- 相当于 Java 中的一个方法
- **不通用**，MySQL 中判空函数 ifnull(xxx,100)，PostgreSQL 中判空函数 coalesce(xxx,100)
- 只对一行结果进行操作，注意与 **组函数** 区别



### 字符串（重要）

==字符串是索引是从 1 开始的==，helloworld，h 是第1个字符，e 是第2个字符

| 函数                     | 含义                                                         | 示例                                 | 常用     |
| ------------------------ | ------------------------------------------------------------ | ------------------------------------ | -------- |
| concat(s1,s2,s3...)      | 拼接字符串 s1,s2,s3...                                       | select concat('闻家奇', '很', '帅')  | ==常用== |
| concat_ws(x,s1,s2,s3...) | 拼接字符串 s1,s2,s3...，每个字符串中间加上字符 x             | select concat_ws(',', 'a', 'b', 'c') | ==常用== |
|                          |                                                              |                                      |          |
| char_length(str)         | 返回字符串 str 的字符个数                                    | select char_length('闻C真帅😀')       | **重要** |
| length(str)              | 返回字符串 str 的字节个数，ascii 1个字节，中文 3个字节，emoji 4个字节 | select length('闻C真帅😀')            | **重要** |
|                          |                                                              |                                      |          |
| upper(str)，ucase(str)   | 将字符串全部大写                                             | select upper('helloworld')           |          |
| lower(str)，lcase(str)   | 将字符串全部小写                                             | select lower('HelloWorld')           |          |
|                          |                                                              |                                      |          |
| trim(str)                | 对字符串 str 左右去空格                                      | select trim(' hello world ')         | ==常用== |
| ltrim(str)               | 对字符串 str 左边去空格                                      | select ltrim(' hello world ')        |          |
| rtrim(str)               | 对字符串 str 右边去空格                                      | select rtrim(' hello world ')        |          |
|                          |                                                              |                                      |          |
| lpad(str,len,pad)        | 左填充函数，对 str 取 len 长度，不足长度的，左边用 pad 填充  | 用于右对齐，比如金额                 | 了解     |
| rpad(str,len,pad)        | 右填充函数，对 str 取 len 长度，不足长度的，右边用 pad 填充  | 用于左对齐，比如家庭住址，姓名       | 了解     |

```mysql
select concat('闻家奇', '很', '帅')          as str,  -- 拼接字符串
       concat_ws(',', 'a', 'b', 'c')       as str,  -- 使用逗号,拼接字符串
       concat_ws(' ', 'hello', 'mysql')    as str   -- 使用空格,拼接字符串
from dual
```

![image-20220722003721811](https://attach.blog.wen7.online/20220722003721.png)

```mysql
select char_length('hello')         as "字符数",   -- 有 5 个字符
       char_length('闻家奇很帅')     as "字符数",   -- 有 5 个字符
       char_length('闻老C很帅')     as "字符数",   -- 有 5 个字符
       char_length('闻老C很帅🐼')    as "字符数",   -- 有 6 个字符
       length('hello')              as "字节数",   -- 字母 1个字节,一共5个字节
       length('闻家奇很帅')          as "字节数",   -- 汉字 3个字节,5*3=15个字节
       length('闻老C很帅')          as "字节数",    -- 4*3+1=13个字节
       length('闻老C很帅🐼')         as "字节数"    -- emoji 4个字节,4*3+1+4=17个字节
from dual
```

![image-20220722004834776](https://attach.blog.wen7.online/20220722004834.png)

```mysql
select upper('helloworld') as "大写",
       ucase('helloworld') as "大写",
       lower('HelloWorld') as "小写",
       lcase('HelloWorld') as "小写"
from dual								-- 意义不大,因为 MySQL 对大小写并不敏感
```

![image-20220722005432426](https://attach.blog.wen7.online/20220722005432.png)

```mysql
select trim(' hello world ')               as trim,         -- 字符串左右都去空格
       ltrim(' hello world ')              as ltrim,        -- 字符串左边去空格
       rtrim(' hello world ')              as rtrim,        -- 字符串右边去空格
       char_length(trim(' hello world '))  as trimLength,   -- 查看左右都去掉空格之后的字符长度
       char_length(ltrim(' hello world ')) as ltrimLength,  -- 查看左边去掉空格之后的字符长度
       char_length(rtrim(' hello world ')) as rtrimLength   -- 查看右边去掉空格之后的字符长度
from dual
```

![image-20220722010031023](https://attach.blog.wen7.online/20220722010031.png)

```mysql
select empno,
       ename,
       sal,
       lpad(sal, 10, '*') as lpad,  -- 左对齐,不足的补 * 号,
       lpad(sal, 10, ' ') as lpad,  -- 左对齐,不足的补空格,
       rpad(sal, 10, '+') as rpad,  -- 右对齐,不足的补 + 号
       rpad(sal, 10, ' ') as rpad   -- 右对齐,不足的补空格,
from emp
```

![image-20220722011344185](https://attach.blog.wen7.online/20220722011344.png)



### 数值函数（重要）

#### 基本函数（重要）

| 函数                  | 含义                                     | 示例                            | 常用     |
| --------------------- | ---------------------------------------- | ------------------------------- | -------- |
| rand()                | 返回 [0,1) 的随机数                      | select rand(),rand()            | ==常用== |
| rand(p)               | 因子相同，返回的随机数相同               | select rand(5),rand(5)          |          |
|                       |                                          |                                 |          |
| round(x)              | 对 x 四舍五入                            | select round(123.456)           | ==常用== |
| round(x,n)            | 对 x 四舍五入，保留 n 位小数             | select round(123.456,2)         | ==常用== |
| truncate(x, n)        | 对 x 截断 n 位小数                       | select truncate(123.456,1)      |          |
|                       |                                          |                                 |          |
| ceil(x)               | 对 x 向上取整，进1法                     | select ceil(3.5)                | ==常用== |
| floor(x)              | 对 x 向下取整，去尾法                    | select floor(3.5)               | ==常用== |
|                       |                                          |                                 |          |
| abs(x)                | 返回 x 的绝对值                          | select abs(-5),abs(5)           |          |
| sign(x)               | 返回 x 的符号，0 返回 0，正数返回 1      | select sign(-5),sign(0),sign(5) |          |
| pi()                  | 返回 π 的值                              | select pi()                     |          |
|                       |                                          |                                 |          |
| least(x1,x2,x3...)    | 返回 x1,x2,x3...中最小值                 | select least(1,2,3)             |          |
| greatest(x1,x2,x3...) | 返回 x1,x2,x3... 中最大值                | select greatest(1,2,3)          |          |
|                       |                                          |                                 |          |
| mod(x,y)              | 返回 x÷y 得到的余数                      | select mod(11,3)                |          |
| sqrt(x)               | 返回 x 开平方之后的值，x = 负数返回 null | select sqrt(9),sqrt(-9)         |          |

```mysql
select rand()               as '随机数A',   -- 【0.8097804196270001】
       rand()               as '随机数B',   -- 【0.6456843341194879】
       rand(5)              as '随机数C',   -- 【0.40613597483014313】
       rand(5)              as '随机数C`',  -- 【0.40613597483014313】 因为 rand(5) 是同一个因子,C 和 C` 相同
       round(123.456)       as round,      -- 四舍五入,保留整数【123】
       round(123.5)         as round,      -- 四舍五入,保留整数【124】
       round(123.456, 0)    as round0,     -- 四舍五入,保留 0 位小数【123】
       round(123.456, 1)    as round1,     -- 四舍五入,保留 1 位小数【123.5】
       round(123.456, 2)    as round2,     -- 四舍五入,保留 2 位小数【123.46】
       truncate(123.456, 0) as truncate,   -- 截断小数,只保留 0 位小数,直接丢弃其他,不会进行四舍五入【123】
       truncate(123.456, 1) as truncate,   -- 截断小数,只保留 1 位小数,直接丢弃其他,不会进行四舍五入【123.4】
       truncate(123.456, 2) as truncate,   -- 截断小数,只保留 2 位小数,直接丢弃其他,不会进行四舍五入【123.45】
       truncate(123.456, 3) as truncate,   -- 截断小数,只保留 3 位小数,直接丢弃其他,不会进行四舍五入【123.456】
       ceil(3.5)            as ceil,       -- 【4】
       ceil(-3.5)           as ceil,       -- 【-3】
       floor(3.5)           as floor,      -- 【3】
       floor(-3.5)          as floor,      -- 【-4】
       abs(-5)              as abs,        -- 返回绝对值【5】
       abs(5)               as abs,        -- 返回绝对值【5】
       sign(-5)             as sign,       -- 返回正负,负数返回 -1【-1】
       sign(0)              as sign,       -- 返回正负,0 返回 0【0】
       sign(5)              as sign,       -- 返回正负,正数返回 1【1】
       pi()                 as pi,         -- 返回 π 的值【3.141593】
       pi()                 as pi,         -- 返回 π 的值【3.141593】
       least(1, 2, 3)       as least,      -- 返回数列中最小的值【1】
       greatest(1, 2, 3)    as greatest,   -- 返回数列中最大的值【3】
       mod(11, 3)           as '余数',      -- 返回 11÷3=3......2 的余数【2】
       sqrt(-9)             as '开平方',    -- 返回 -9 的开平方根,-9 为负数,返回 null【null】
       sqrt(9)              as '开平方'     -- 返回 9 的开平方根【3】
from dual
```

```mysql
select rand()  as '随机数A', -- 0.8097804196270001
       rand()  as '随机数B', -- 0.6456843341194879
       rand(5) as '随机数C', -- 0.40613597483014313
       rand(5) as '随机数C`' -- 0.40613597483014313 因为 rand(5) 是同一个因子,C 和 C` 相同
from dual
```

![image-20220721230857825](https://attach.blog.wen7.online/20220721230857.png)

```mysql
select round(123.456)       as round,    -- 四舍五入,保留整数
       round(123.5)         as round,    -- 四舍五入,保留整数
       round(123.456, 0)    as round0,   -- 四舍五入,保留 0 位小数
       round(123.456, 1)    as round1,   -- 四舍五入,保留 1 位小数
       round(123.456, 2)    as round2,   -- 四舍五入,保留 2 位小数
       truncate(123.456, 0) as truncate, -- 截断小数,只保留 0 位小数,直接丢弃其他,不会进行四舍五入
       truncate(123.456, 1) as truncate, -- 截断小数,只保留 1 位小数,直接丢弃其他,不会进行四舍五入
       truncate(123.456, 2) as truncate, -- 截断小数,只保留 2 位小数,直接丢弃其他,不会进行四舍五入
       truncate(123.456, 3) as truncate  -- 截断小数,只保留 3 位小数,直接丢弃其他,不会进行四舍五入
from dual
```

![image-20220721231414489](https://attach.blog.wen7.online/20220721231414.png)

```mysql
select ceil(3.5)   as ceil,     -- 4
       ceil(-3.5)  as ceil,     -- -3
       floor(3.5)  as floor,    -- 3
       floor(-3.5) as floor     -- -4
from dual
```

<img src="https://attach.blog.wen7.online/20220721230507.png" alt="image-20220721230507569" style="zoom:67%;" />

```mysql
select abs(-5)  as abs,     -- 返回绝对值
       abs(5)   as abs,     -- 返回绝对值
       sign(-5) as sign,    -- 返回正负,负数返回 -1
       sign(0)  as sign,    -- 返回正负,0 返回 0
       sign(5)  as sign,    -- 返回正负,正数返回 1
       pi()     as pi,      -- 返回 π 的值
       pi()     as pi       -- 返回 π 的值
from dual
```

<img src="https://attach.blog.wen7.online/20220721231714.png" alt="image-20220721231714595" style="zoom:67%;" />

```mysql
select least(1, 2, 3)    as least,      -- 返回数列中最小的值
       greatest(1, 2, 3) as greatest,   -- 返回数列中最大的值
       mod(11, 3)        as '余数',      -- 返回 11÷3=3......2 的余数
       sqrt(-9)          as '开平方',    -- 返回 -9 的开平方根,-9 为负数,返回 null
       sqrt(9)           as '开平方'     -- 返回 9 的开平方根,3
from dual
```

<img src="https://attach.blog.wen7.online/20220721232046.png" alt="image-20220721232046762" style="zoom:67%;" />



#### 角度与弧度

<img src="https://attach.blog.wen7.online/20220721233727.png" alt="image-20220721233727675" style="zoom: 80%;" />

| 函数       | 含义             | 示例                                   | 常用 |
| ---------- | ---------------- | -------------------------------------- | ---- |
| radians(x) | 将角度转化为弧度 | select radians(90),radians(180)        |      |
| degrees(x) | 将弧度转换为角度 | select degrees(pi()),degrees(pi() / 2) |      |

```mysql
select radians(30)       as '弧度', 	-- π/6
       radians(90)       as '弧度', 	-- π/2
       radians(180)      as '弧度', 	-- π
       degrees(pi())     as '角度', 	-- 180°
       degrees(pi() / 2) as '角度', 	-- 90°
       degrees(pi() / 6) as '角度'  	-- 30°
from dual
```

![image-20220721233618056](https://attach.blog.wen7.online/20220721233618.png)



#### 三角函数

<img src="https://attach.blog.wen7.online/20220721234055.png" alt="image-20220721234055644" style="zoom: 50%;" />

| 函数   | 含义                        | 示例                                 | 常用 |
| ------ | --------------------------- | ------------------------------------ | ---- |
| sin(x) | 返回 x 正弦值，x 为弧度值   | select sin($\fracπ6$),sin($\fracπ2$) |      |
| cos(x) | 返回 x 余弦值，x 为弧度值   | select cos(0),cos($\fracπ3$)         |      |
| tan(x) | 返回 x 正切值，x 为弧度值   |                                      |      |
| cot(x) | 返回 x 的余切值，x 为弧度值 |                                      |      |

<img src="https://attach.blog.wen7.online/20220721234430.png" alt="image-20220721234430482" style="zoom: 50%;" />

```mysql
select sin(0)        as 'sin(0)',   -- sin(0) = 0
       sin(pi() / 6) as 'sin(π/6)', -- sin(π/6) = 1/2
       sin(pi() / 2) as 'sin(π/2)', -- sin(π/2) = 1
       cos(0)        as 'cos(0)',   -- cos(0) = 1
       cos(pi() / 3) as 'cos(π/3)'  -- cos(π) = 1/2
from dual
```

<img src="https://attach.blog.wen7.online/20220722000203.png" alt="image-20220722000202944" style="zoom: 67%;" />



#### 指数与对数

| 函数                 | 含义                 | 示例                          | 常用 |
| -------------------- | -------------------- | ----------------------------- | ---- |
| pow(x,n)，power(x,n) | 返回 x 的 n 次方     | select pow(2,3),power(2,4)    |      |
| exp(n)               | 返回 e 的 n 次方     | select exp(2),exp(3)          |      |
|                      |                      |                               |      |
| log2(x)              | 返回以 2 为底的对数  | select log2(8),log2(16)       |      |
| log10(x)             | 返回以 10 为底的对数 | select log10(100),log10(1000) |      |
| log(x)，ln(x)        | 返回以 e 为底的对数  | select log(exp(2)),ln(exp(3)) |      |

```mysql
select pow(2, 3)   as pow,        -- 2 的 3 次方 = 8
       power(2, 4) as pow,        -- 2 的 4 次方 = 16
       exp(2)      as e2,         -- e 的 平方
       exp(3)      as e3,         -- e 的 3次方
       log2(8)     as log2_8,     -- 以 2 为底,8的对数
       log2(16)    as log2_16,    -- 以 2 为底,16的对数
       log10(100)  as log10_100,  -- 以 10 为底,100的对数
       log10(1000) as log10_1000, -- 以 10 为底,1000的对数
       log(exp(2)) as loge_e2,    -- 以 e 为底,e平方的对数
       ln(exp(3))  as loge_e3     -- 以 e 为底,e三方的对数
from dual
```

![image-20220722001336553](https://attach.blog.wen7.online/20220722001336.png)



#### 进制转换

| 函数        | 含义                                                      | 示例                               | 常用 |
| ----------- | --------------------------------------------------------- | ---------------------------------- | ---- |
| bin(x)      | 返回 x 的二进制编码                                       | select bin(8),bin(4),bin(2),bin(1) |      |
| oct(x)      | 返回 x 的八进制编码                                       | select oct(64),oct(8),oct(1)       |      |
| hex(x)      | 返回 x 的十六进制编码                                     | select hex(256),hex(16),oct(1)     |      |
| conv(x,A,B) | 将 x 当成 A 进制，从 A 进制变成 B 进制，返回 B 进制的编码 | select conv(1000000, 2, 10)        |      |

```mysql
select bin(8),   -- 十进制的 8 转成二进制,为 1000
       bin(4),   -- 十进制的 4 转成二进制,为 0100
       bin(2),   -- 十进制的 2 转成二进制,为 0010
       bin(1),   -- 十进制的 1 转成二进制,为 0001
       oct(64),  -- 十进制的 64 转成八进制,为 0100
       oct(8),   -- 十进制的 8  转成八进制,为 0010
       oct(1),   -- 十进制的 1  转成八进制,为 0001
       hex(256), -- 十进制的 256 转成十六进制,为 0100
       hex(16),  -- 十进制的 16  转成十六进制,为 0010
       hex(1)    -- 十进制的 1   转成十六进制,为 0001
from dual
```

![image-20220722002255267](https://attach.blog.wen7.online/20220722002255.png)

```mysql
select conv(1000000, 2, 10) as '64,2转10',
       conv(1000000, 2, 8)  as '64,2转8',
       conv(10000, 2, 10)   as '16,2转10',
       conv(10000, 2, 8)    as '16,2转8',
       conv(1000, 2, 10)    as '8,2转10',
       conv(1000, 2, 8)     as '8,2转8'
from dual
```

![image-20220722002800743](https://attach.blog.wen7.online/20220722002800.png)



### 日期函数（重要）

#### 前言

- 时间

	- 日期（年月日）**date**
	- 时间（时分秒）**time**

- 时区

	- **世界标准时间 UTC**，以前是格林威治标准时间 GMT
	- 北京时间 UTC + 8，北京时间比 UTC 早 8 小时

- 常见类型转换

	- 字符串类型，"2020-02-02 18:18:18"

	- 日期类型，SQL 语句查询出来展示的时候和字符串一样，在 IntelliJ IDEA 中，鼠标点进去日期类型有弹窗

	- 时间戳类型，

	- ```mysql
		select '2020-02-02 18:18:18'                                                   as "字符串类型",
		       unix_timestamp(str_to_date('2020-02-02 18:18:18', '%Y-%m-%d %H:%i:%S')) as "时间戳",
		       str_to_date('2020-02-02 18:18:18', '%Y-%m-%d %H:%i:%S')                 as "日期类型"
		from dual;
		```

	- <img src="https://attach.blog.wen7.online/image-20220722125008097.png" alt="image-20220722125008097" style="zoom: 67%;" />



#### 获取日期和时间

| 函数                | 含义                                       | 示例                  | 常用     |
| ------------------- | ------------------------------------------ | --------------------- | -------- |
| now()               | 获取当前日期和时间，包含**年月日，时分秒** | select now()          | ==常用== |
| sysdate()           | 同上，Oracle 中是关键字 sysdate            |                       | ==常用== |
| current_timestamp() | 同上                                       |                       |          |
| localtime()         | 同上                                       |                       |          |
| localtimestamp()    | 同上                                       |                       |          |
|                     |                                            |                       |          |
| curdate()           | 获取当前日期，只包含**年月日**             | select curdate()      | ==常用== |
| current_date()      | 同上                                       | select current_date() | ==常用== |
| curtime()           | 获取当前时间，只包含**时分秒**             | select curtime()      | ==常用== |
| current_time()      | 同上                                       | select current_time() | ==常用== |
|                     |                                            |                       |          |
| UTC_date()          | 返回 UTC 日期，                            | select UTC_date()     |          |
| UTC_time()          | 返回 UTC 时间，北京时间 = UTC + 8          | select UTC_time()     |          |

```mysql
select now()               as "当前date和time",
       sysdate()           as "当前date和time",
       current_timeStamp() as "当前date和time",
       localTime()         as "当前date和time",
       localTimeStamp()    as "当前date和time"
from dual
```

![image-20220722122423138](https://attach.blog.wen7.online/image-20220722122423138.png)

```mysql
select curdate()      as "当前date",
       current_date() as "当前date",
       curtime()      as "当前time",
       current_time() as "当前time"
from dual
```

![image-20220722122747503](https://attach.blog.wen7.online/image-20220722122747503.png)

```mysql
select UTC_date()     as "UTC-date",
       UTC_time()     as "UTC-time",
       current_time() as "北京-time"  -- 北京时间 = UTC + 8
from dual
```

![image-20220722123326726](https://attach.blog.wen7.online/image-20220722123326726.png)



#### 格式化

| 函数                       | 含义                               | 示例                                                         | 常用       |
| -------------------------- | ---------------------------------- | ------------------------------------------------------------ | ---------- |
| date_format(date，"格式")  | 将 日期 按照 格式，转换成字符串    | select date_format(now(), '%Y-%m-%d %H:%i:%S')               | ==常用==   |
| time_format(time，"格式")  | 将 时间 按照 格式，转换成字符串    | select time_format(now(), '%H:%i:%S')                        |            |
|                            |                                    |                                                              |            |
| str_to_date(str,"格式")    | 将 字符串 按照格式，转成 date 类型 | select str_to_date('2020-02-02 18:18:18', '%Y-%m-%d %H:%i:%S') | ==常用==   |
|                            |                                    |                                                              |            |
| get_format(日期类型，地区) | 获取不同地区 format 格式，习惯不同 | select get_format(DATE, 'USA')                               | ==全球化== |

```mysql
select date_format(now(), '%Y-%m-%d %H:%i:%S')                 as "date 格式化成字符串",
       time_format(now(), '%Y-%m-%d %H:%i:%S')                 as "time 格式化成字符串",
       time_format(now(), '%H:%i:%S')                          as "time 格式化成字符串",
       str_to_date('2020-02-02 18:18:18', '%Y-%m-%d %H:%i:%S') as "字符串转 date 和 time"
from dual
```

![image-20220722133243308](https://attach.blog.wen7.online/image-20220722133243308.png)

```mysql
select get_format(DATE, 'USA')          as "美国 date 格式",
       get_format(TIME, 'USA')          as "美国 time 格式",
       get_format(DATETIME, 'USA')      as "美国 datetime 格式",
       get_format(DATE, 'ISO')          as "国际标准组织 date 格式",
       get_format(TIME, 'ISO')          as "国际标准组织 time 格式",
       get_format(DATETIME, 'ISO')      as "国际标准组织 datetime 格式"
from dual
```

![image-20220722150708103](https://attach.blog.wen7.online/image-20220722150708103.png)



##### 格式符

| 分类 | 格式符               | 名称           | 说明                                        | 示例                              |   常用   |
| :--: | -------------------- | -------------- | ------------------------------------------- | --------------------------------- | :------: |
|  年  | %Y                   | 年份(四位)     | 4位数字表述年份                             | 2020，2022...                     | ==常用== |
|  年  | %y                   | 年份(两位)     | 2位数字表述年份                             | 98，20，22...                     |          |
|      |                      |                |                                             |                                   |          |
|  月  | %M                   | 月份(英文)     | 英文表述月份                                | January，October...               |   外国   |
|  月  | %b                   | 月份(英缩)     | 英文表述月份（缩写）                        | Jan，Feb...                       |   外国   |
|  月  | %m                   | 月份(补零)     | 2位数字表述月份                             | 01，02，08，11...                 | ==常用== |
|  月  | %c                   | 月份(缺零)     | 数字表述月份                                | 1，2，3，8，11...                 |          |
|      |                      |                |                                             |                                   |          |
|  日  | %D                   | 月中天数(英缩) | 英文后缀表示月中的天数                      | 1st，2nd，3rd...                  |          |
|  日  | %d                   | 月中天数(补零) | 2位数字表述月中的天数                       | 01，02，08，11，31...             | ==常用== |
|  日  | %e                   | 月中天数(缺零) | 数字表述月中的天数                          | 1，2，3，8，11，31...             |          |
|  日  | %j                   | 年中天数(补零) | 数字表述在年中的天数                        | 001，002，365......               |          |
|  日  | %w                   | 周中天数(补零) | 数字表述在周中的天数                        | **0（星期日）**，1，2，3，4，5，6 |          |
|      |                      |                |                                             |                                   |          |
|  时  | %H                   | 24时(补零)     | 2位数字表述小时，24小时制                   | 01，02，08，11，23...             | ==常用== |
|  时  | %k                   | 24时(缺零)     | 数字表述小时，24小时制                      | 1，2，8，11，23...                |          |
|  时  | %h 和 %I（大写的 i） | 12时(补零)     | 2位数字表述小时，12 小时制                  | 01，02，08，11...                 | 搭配 %p  |
|  时  | %l （小写的 L）      | 12时(缺零)     | 数字表述小时，12 小时制                     | 1，2，8，11...                    |          |
|      |                      |                |                                             |                                   |          |
|  分  | %i                   | 分钟(补零)     | 2位数字表述分钟                             | 01，02，08，59...                 | ==常用== |
|      |                      |                |                                             |                                   |          |
|  秒  | %S 和 %s             | 秒钟(补零)     | 2位数字表述秒                               | 00，01，02，59...                 | ==常用== |
|      |                      |                |                                             |                                   |          |
|  周  | %W                   | 星期几(英文)   | 一周中星期的名称                            | Sunday，Monday...                 |          |
|  周  | %a                   | 星期几(英缩)   | 一周中星期的缩写                            | Sun，Mon...                       |          |
|  周  | %U                   | 第几周()       | 数字表述在年中的第几周，以 Sunday 为周第1天 | 1，2，8，51...                    |          |
|  周  | %u                   | 第几周()       | 数字表述在年中的第几周，以 Monday 为周第1天 | 1，2，8，51...                    |          |
|      |                      |                |                                             |                                   |          |
|      | %T                   |                | 时分秒，24小时制                            | 14:58:10                          |          |
|      | %r                   |                | 时分秒，12小时制                            | 02:58:10 PM                       |          |
|      | %p                   |                | AM 或 PM                                    | AM，PM                            |          |
|      | %%                   |                | 转义 %                                      | %                                 |          |

```mysql
select date_format(t.tmpDate, '%Y')     as "年份(四位) %Y",   -- 2020
       date_format(t.tmpDate, '%y')     as "年份(两位) %y",   -- 20

       date_format(t.tmpDate, '%M')     as "月份(英文) %M",   -- February
       date_format(t.tmpDate, '%b')     as "月份(英缩) %b",   -- Feb
       date_format(t.tmpDate, '%m')     as "月份(补零) %m",   -- 02
       date_format(t.tmpDate, '%c')     as "月份(缺零) %c",   -- 2

       date_format(t.tmpDate, '%D')     as "月中天数(英缩) %D", -- 2nd
       date_format(t.tmpDate, '%d')     as "月中天数(补零) %d", -- 02
       date_format(t.tmpDate, '%e')     as "月中天数(缺零) %e", -- 2
       date_format(t.tmpDate, '%j')     as "年中天数(补零) %j", -- 033
       date_format(t.tmpDate, '%w')     as "周中天数(补零) %w", -- 0

       date_format(t.tmpDate, '%H')     as "24时(补零) %H",  -- 07
       date_format(t.tmpDate, '%k')     as "24时(缺零) %k",  -- 7
       date_format(t.tmpDate, '%h')     as "12时(补零) %h",  -- 07
       date_format(t.tmpDate, '%l')     as "12时(缺零) %l",  -- 7

       date_format(t.tmpDate, '%i')     as "分钟(补零) %i",   -- 08
       date_format(t.tmpDate, '%i') + 0 as "分钟(加0去0)",    -- 8
       date_format(t.tmpDate, '%S')     as "秒钟(补零) %S",   -- 09
       date_format(t.tmpDate, '%S') + 0 as "秒钟(加0去0)",    -- 9

       date_format(t.tmpDate, '%W')     as "星期几(英文)",     -- Sunday
       date_format(t.tmpDate, '%a')     as "星期几(英缩)",     -- Sun
       date_format(t.tmpDate, '%U')     as "第几周()",       -- 05
       date_format(t.tmpDate, '%u')     as "第几周()",       -- 05

       date_format(t.tmpDate, '%T')     as "时分秒(24小时)",   -- 07:08:09
       date_format(t.tmpDate, '%r')     as "时分秒(12小时)",   -- 07:08:09 AM
       date_format(t.tmpDate, '%p')     as "AM/PM",       -- AM

       date_format(t.dateTmp, '%T')     as "时分秒(24小时)",   -- 17:18:19
       date_format(t.dateTmp, '%r')     as "时分秒(12小时)",   -- 05:18:19 PM
       date_format(t.dateTmp, '%p')     as "AM/PM"        -- PM
from (select str_to_date('2020-02-02 07:08:09', '%Y-%m-%d %H:%i:%S') as tmpDate,
             str_to_date('2020-02-02 17:18:19', '%Y-%m-%d %H:%i:%S') as dateTmp
      from dual) t;
```



##### 地区格式符

| 日期类型 | 格式化类型                | 返回的格式化字符串 |
| -------- | ------------------------- | ------------------ |
| DATE     | USA（**美国**）           | %m.%d.%Y           |
| DATE     | JIS                       | %Y-%m-%d           |
| DATE     | ISO（**国际标准化组织**） | %Y-%m-%d           |
| DATE     | EUR                       | %d.%m.%Y           |
| DATE     | INTERNAL                  | %Y%m%d             |
|          |                           |                    |
| TIME     | USA                       | %h:%i:%s %P        |
| TIME     | JIS                       | %H:%i:%s           |
| TIME     | ISO                       | %H:%i:%s           |
| TIME     | EUR                       | %H.%i.%s           |
| TIME     | INTERNAL                  | %H%i%s             |
|          |                           |                    |
| DATETIME | USA                       | %Y-%m-%d %H.%i.%s  |
| DATETIME | JIS                       | %Y-%m-%d %H:%i:%s  |
| DATETIME | ISO                       | %Y-%m-%d %H:%i:%s  |
| DATETIME | EUR                       | %Y-%m-%d %H.%i.%s  |
| DATETIME | INTERNAL                  | %Y%m%d%H%i%s       |

```mysql
select get_format(DATE, 'USA')     as "美国 date",                -- %m.%d.%Y
       get_format(TIME, 'USA')     as "美国 time",                -- %h:%i:%s %p
       get_format(DATETIME, 'USA') as "美国 datetime",            -- %Y-%m-%d %H.%i.%s

       get_format(DATE, 'ISO')     as "国际标准化组织 date",       -- %Y-%m-%d
       get_format(TIME, 'ISO')     as "国际标准化组织 time",       -- %H:%i:%s
       get_format(DATETIME, 'ISO') as "国际标准化组织 datetime"    -- %Y-%m-%d %H:%i:%s
from dual
```

![image-20220722160059128](https://attach.blog.wen7.online/image-20220722160059128.png)



#### 获取年月日时分秒（函数）

| 函数                         | 含义                                   | 示例                 | 常用     |
| ---------------------------- | -------------------------------------- | -------------------- | -------- |
| year(date)                   | 获取年                                 | select year(now())   | ==常用== |
| month(date)                  | 获取月                                 | select month(now())  | ==常用== |
| day(date)                    | 获取日                                 | select day(now())    | ==常用== |
| hour(time)                   | 获取小时                               | select hour(now())   | ==常用== |
| minute(time)                 | 获取分钟                               | select minute(now()) | ==常用== |
| second(time)                 | 获取秒钟                               | select second(now()) | ==常用== |
|                              |                                        |                      |          |
| monthname(date)              | 获取月份                               | January，...         |          |
| dayname(date)                | 返回星期几                             | Monday，Sunday...    |          |
| weekday(date)                | 返回周几，**周一是0，周日是6**         |                      |          |
| quarter(date)                | 返回季度，123月第1季度                 | 1,2,3,4              |          |
|                              |                                        |                      |          |
| week(date)，weekofyear(date) | 返回一年中第几周                       |                      |          |
| dayofyear(date)              | 返回一年中第几天                       |                      |          |
| dayofmonth(date)             | 返回一月中第几天                       |                      |          |
| dayofweek(date)              | 返回一周中第几天，**周日是1，周六是7** |                      |          |

```mysql
select year(now())         as "年",
       month(now())        as "月",
       day(now())          as "日",
       hour(now())         as "时",
       minute(now())       as "分",
       second(now())       as "秒",
       year('2022-02-03')  as "年",  -- 2022
       month('2022-02-03') as "月",  -- 2
       day('2022-02-03')   as "日",  -- 3
       hour('17:18:19')    as "时",  -- 17
       minute('17:18:19')  as "分",  -- 18
       second('17:18:19')  as "秒"   -- 19
from dual
```

![](https://attach.blog.wen7.online/image-20220722160851082.png)

```mysql
select monthname(now())  as "月",
       dayname(now())    as "周几",
       weekday(now())    as "周几", -- 周一(0) 周二(1) 周三(2) 周四(3) 周五(4) 周六(5) 周日(6)
       quarter(now())    as "季度", -- 一二三月:1  四五六月:2  七八九月:3 ...

       week(now())       as "年周", -- 一年中第几周
       weekofyear(now()) as "年周",
       dayofyear(now())  as "年天",
       dayofmonth(now()) as "月天",
       dayofweek(now())  as "周天"  -- 周日(1) 周一(2) 周二(3) 周三(4) 周四(5) 周五(6) 周六(7)
from dual
```

![image-20220722162455384](https://attach.blog.wen7.online/image-20220722162455384.png)



#### 获取年月日时分秒（extract）

| 函数                    | 说明               |
| ----------------------- | ------------------ |
| extract(类型 from 日期) | 返回日期中特定部分 |

| 类型取值      | 含义                     | 常用     |
| ------------- | ------------------------ | -------- |
| year          | 返回年份                 | ==常用== |
| month         | 返回月份                 | ==常用== |
| day           | 返回天数，一个月中第几天 | ==常用== |
| hour          | 返回小时                 | ==常用== |
| minute        | 返回分钟                 | ==常用== |
| second        | 返回秒钟                 | ==常用== |
|               |                          |          |
| week          | 返回在一年中第几个星期   |          |
| quarter       | 返回在一年中第几个季度   |          |
|               |                          |          |
| year_month    | 返回年和月               |          |
| day_hour      | 返回一天中的小时数       |          |
| day_minute    | 返回小时拼接分钟         |          |
| day_second    | 返回小时拼接分钟拼接秒钟 |          |
| hour_minute   | 返回小时拼接分钟         |          |
| hour_second   | 返回小时拼接分钟拼接秒钟 |          |
| minute_second | 返回分钟拼接秒钟         |          |

```mysql
select extract(year from now())               as "年份",
       extract(month from now())              as "月份",
       extract(day from now())                as "天数",
       extract(hour from now())               as "小时",
       extract(minute from now())             as "分钟",
       extract(second from now())             as "秒钟",

       extract(week from now())               as "星期",
       extract(quarter from now())            as "季度",

       extract(year_month from now())         as "年月",
       extract(day_hour from now())           as "小时",
       extract(day_minute from now())         as "小时_分钟",
       extract(day_second from now())         as "小时_分钟_秒钟",
       extract(hour_minute from now())        as "小时_分钟",
       extract(hour_second from now())        as "小时_分钟_秒钟",
       extract(minute_second from now())      as "分钟_秒钟"
from dual
```

![image-20220722164912010](https://attach.blog.wen7.online/image-20220722164912010.png)



#### 时间戳

| 函数                     | 含义                 | 示例                         | 常用     |
| ------------------------ | -------------------- | ---------------------------- | -------- |
| unix_timestamp()         | 返回当前时间的时间戳 | select unix_timestamp()      | ==常用== |
| unix_timestamp(date)     | 返回指定时间的时间戳 | select unix_timestamp(now()) | ==常用== |
|                          |                      |                              |          |
| from_unixtime(timestamp) | 返回时间戳的时间     | select from_unixtime()       | ==返回== |

```mysql
select unix_timestamp()                      as "当前时间时间戳",
       unix_timestamp(now())                 as "指定时间时间戳",
       unix_timestamp('2020-02-02 18:18:18') as "指定时间时间戳",
       from_unixtime(1580638698)             as "时间戳指代时间"
from dual
```

![image-20220725095050796](https://attach.blog.wen7.online/image-20220725095050796.png)

 

#### 日期计算

| 函数                               | 含义                                  | 示例                                   | 常用     |
| ---------------------------------- | ------------------------------------- | -------------------------------------- | -------- |
| date_add(时间,interval  数值 类型) | 操作时间，数值为负就是减少            | select date_add(now(),interval  1 day) | ==常用== |
| adddate(时间,interval 数值 类型)   |                                       | select adddate(now(),interval  1 day)  | ==常用== |
| date_sub(时间,interval 数值 类型)  | 操作时间                              |                                        |          |
| subdate(时间,interval 数值 类型)   |                                       |                                        |          |
|                                    |                                       |                                        |          |
| last_day(date)                     | 返回 date 所在月份最后1天的日期       | select last_day(now())                 | ==常用== |
| addtime(time1,time2)               | 时间1 + 时间2                         |                                        |          |
| subtime(time1,time2)               |                                       |                                        |          |
| datediff(日期1，日期2)             | 返回 日期1-日期2 的间隔天数           |                                        |          |
| timediff(时间1，时间2)             | 返回 时间1-时间2 的时间间隔（时分秒） |                                        |          |
| maketime(hour,minute,second)       | 时分秒合并返回                        |                                        |          |

```mysql
select now()                            as "当前时间",
       date_add(now(), interval 1 day)  as "添加1天",
       date_add(now(), interval -1 day) as "减少1天",
       adddate(now(), interval 2 hour)  as "添加2小时",
       adddate(now(), interval -2 hour) as "减少2小时"
from dual
```

![image-20220725141719474](https://attach.blog.wen7.online/image-20220725141719474.png)

```mysql
select now()                                  as "当前时间",
       last_day(now())                        as "当前日期所在月最后一天",
       addtime('04:05:06', '01:02:03')        as "时分秒相加",
       subtime('04:05:06', '01:02:03')        as "时分秒相减",
       datediff(now(), '2000-01-01 00:00:00') as "时间间隔/天",
       timediff(now(), '2000-01-01 00:00:00') as "时间间隔/时分秒",
       maketime(12, 13, 14)                   as "时分秒合并"
from dual
```

![image-20220725143038131](https://attach.blog.wen7.online/image-20220725143038131.png)



##### 间隔类型

| 间隔类型      | 含义       |   常用   |
| ------------- | ---------- | :------: |
| year          | 年         | ==常用== |
| month         | 月         | ==常用== |
| day           | 日         | ==常用== |
| hour          | 时         | ==常用== |
| minute        | 分         | ==常用== |
| second        | 秒         | ==常用== |
|               |            |          |
| year_month    | 年和月     |          |
| day_hour      | 日和小时   |          |
| day_minute    | 日和分钟   |          |
| day_second    | 日和秒     |          |
| hour_minute   | 小时和分钟 |          |
| hour_second   | 小时和秒   |          |
| minute_second | 分钟和秒   |          |



###  流程控制函数（重要）

| 函数                    | 含义                                                       | 常用     |
| ----------------------- | ---------------------------------------------------------- | -------- |
| ifnull(值1，值2)        | 用来判空，如果值1不为null，返回值1，如果值1为null，返回值2 | ==常用== |
| if(flag，值1，值2)      | 类似三元运算符，flag 为 true，返回值1，为false 返回值2     |          |
|                         |                                                            |          |
| case when then else end | **详情见独立文档**                                         | ==常用== |

```mysql
select empno,
       ename,
       ifnull(mgr, -1) as "上级管理者编号"
from emp
```

![image-20220725144721203](https://attach.blog.wen7.online/image-20220725144721203.png)

```mysql
select if(true, '刘亦菲', '倪妮')  as "flag=true",
       if(false, '刘亦菲', '倪妮') as "flag=false",
       if(1, '刘亦菲', '倪妮')     as "flag=1",
       if(0, '刘亦菲', '倪妮')     as "flag=0"
from dual
```

![image-20220725145259387](https://attach.blog.wen7.online/image-20220725145259387.png)



### 加解密函数

| 函数                 | 含义                                                 | 常用        |
| -------------------- | ---------------------------------------------------- | ----------- |
| MD5(字符串)          | 对字符串进行 md5 加密，**不可逆**                    | ==常用==    |
| SHA(字符串)，        | 对字符串进行 sha 加密，比 md5 更安全一点，**不可逆** | ==常用==    |
|                      |                                                      |             |
| ~~password(字符串)~~ | 对字符串加密，**不可逆**                             | ==8.0废弃== |
| ~~encode(字符串)~~   | 对字符串加密                                         | ==8.0废弃== |
| ~~decode(字符串)~~   | 对字符串解密                                         | ==8.0废弃== |

```mysql
select MD5('hello'),
       SHA('hello')
from dual
```



### 系统函数

| 函数                 | 含义               | 示例                       | 常用 |
| -------------------- | ------------------ | -------------------------- | ---- |
| version()            | 查看版本           | select version()           |      |
| connection_id()      | 查看当前连接数     | select connection_id()     |      |
| database()，schema() | 查看当前所在数据库 | select database(),shcema() |      |
| charset(字符串)      | 查看字符串的字符集 | select charset("闻老C")    |      |
| collation(字符串)    | 查看字符串比较规则 | select collation("闻老C")  |      |
|                      |                    |                            |      |
| user()               | 查看当前连接用户   |                            |      |
| current_user()       | 同上               |                            |      |
| system_user()        | 同上               |                            |      |
| session_user()       | 同上               |                            |      |

```mysql
select version()        as "版本",
       connection_id()  as "连接数",
       database()       as "当前数据库",
       schema()         as "当前schema",
       charset('闻老C')   as "字符集",
       collation('闻老C') as "字符比较规则",
       user()           as "当前用户",
       current_user()   as "当前用户",
       system_user()    as "当前用户",
       session_user()   as "当前用户"
from dual
```

![image-20220725164737809](https://attach.blog.wen7.online/image-20220725164737809.png)



## group by

### 前言

![image-20220726133026155](https://attach.blog.wen7.online/image-20220726133026155.png)

分组之后，只应当出现 **分组字段** + **组函数**



### 分组函数

| 常用组函数  | 含义               | 示例                     |   常用   |
| :---------- | ------------------ | ------------------------ | :------: |
| count(xxxx) | 统计共有多少个     | select count(1) from emp | ==常用== |
| max(xxxx)   | 最大值             | select max(sal) from emp | ==常用== |
| min(xxxx)   | 最小值             | select min(sal) from emp | ==常用== |
| sum(xxxx)   | 求和，只作用于数值 | select sum(sal) from emp | ==常用== |
| avg(xxxx)   | 平均，只作用于数值 | select avg(sal) from emp | ==常用== |
| ......      | ......             | ......                   |  ......  |

```mysql
select count(*)   as "一共的人数",
       max(score) as "分数最高",
       min(score) as "分数最低",
       avg(score) as "平均分",
       sum(score) as "总分"
from t_student
```

![image-20220726133813807](https://attach.blog.wen7.online/image-20220726133813807.png)



#### count

```mysql
select count(*)     as "总记录数",
       count(1)     as "总记录数",
       count(empno) as "查询 empno 总记录数",
       count(mgr)   as "查询 mgr 总记录数"
from emp
```

- 现象：count(*)，count(1)，count(empno) 都是15 条，count(mgr) 14 条
- ==count(xxx) 忽略为 null 的数据==
- 面试题：count(*)，count(1)，count(列名) 哪个好？
	- 有主键使用主键列，count(主键列)
	- 没有主键，使用 count(1)

![image-20220726134129036](https://attach.blog.wen7.online/image-20220726134129036.png)



### group by

```mysql
select 分组字段,组函数
from 表名 
	left join 次表 on 关联关系
	left join 次表 on 关联关系
where 过滤条件
group by 分组字段
order by 排序字段 asc,排序字段 desc
limit [偏移量,]查询行数
```

#### 基本使用

```mysql
-- 按照部门编号分组
select deptno
from emp
group by deptno;
```

![image-20220727174834052](https://attach.blog.wen7.online/202207271748137.png)



#### 多字段

```mysql
select age,gender
from t_student
group by age,gender
```

![image-20220727133321138](https://attach.blog.wen7.online/image-20220727133321138.png)



#### 组函数

```mysql
select deptno   as "部门编号",
       max(sal) as "最高工资",
       min(sal) as "最低工资",
       avg(sal) as "平均工资",
       sum(sal) as "工资总和"
from emp
group by deptno;
```

![image-20220727174924812](https://attach.blog.wen7.online/202207271749879.png)

```mysql
select deptno,max(sal),min(sal),avg(sal),sum(sal)	-- select 后面出现的字段,只能是 group by 跟的字段 deptno,和 组函数
from emp
group by deptno;									-- 分组字段 job
```

- select 后面出现的字段，==只能跟 **分组字段** 和 **组函数**==

	- 分组字段可以不出现
	- 组函数里的字段可以是其他字段

- 虽然 MySQL 里加了其他字段是不会报错的，但是是不规范，不严谨，没有意义的，例如 Oracle 里加其他字段就会报错

	  

#### ~~with rollup~~

```mysql
select deptno, max(sal), min(sal), avg(sal), sum(sal)
from emp
group by deptno with rollup;
```

<img src="https://attach.blog.wen7.online/202207271750050.png" alt="image-20220727175031967" style="zoom:60%;" /><img src="https://attach.blog.wen7.online/202207271751904.png" alt="image-20220727175114833" style="zoom:60%;" />

对最后的结果，再进行一次 组函数计算

- with rollup 和 order by 不能同时使用
	- 助记：with rollup 相当于 Excel 最后一行的统计，如果 order by 的话，with rollup 就有可能不在最后一行，失去了意义



having
---

```mysql
select 分组字段,组函数
from 表名 
	left join 次表 on 关联关系
	left join 次表 on 关联关系
where 过滤条件
group by 分组字段
having 分组之后过滤条件
order by 排序字段 asc,排序字段 desc
limit [偏移量,]查询行数
```

- 因为 where 的执行要先于 group by，如果 group by 之后，再有过滤条件，只能使用 having
- **having 在 group by 分组之后使用**



### 错误使用

```mysql
select deptno   as "部门编号",
       avg(sal) as "平均工资"
from emp
where avg(sal) >= 2000                  -- 【报错】Invalid use of group function(组函数的使用无效)
group by deptno;
```

![image-20220727175234521](https://attach.blog.wen7.online/202207271752586.png)



### 正确使用

```mysql
select deptno   as "部门编号",
       avg(sal) as "平均工资"
from emp
group by deptno
having avg(sal) >= 2000;
```

![image-20220727175339089](https://attach.blog.wen7.online/202207271753161.png)



### where 和 having

查询部门编号为 10，20，30 部门中，平均工资超过 2000 的部门和平均工资

```mysql
select deptno   as "部门编号",
       avg(sal) as "平均工资"
from emp
where deptno in (10,20,30)
group by deptno
having avg(sal) >= 2000 # and deptno in (10,20,30);
```

```mysql
select deptno   as "部门编号",
       avg(sal) as "平均工资"
from emp
# where deptno in (10,20,30)
group by deptno
having avg(sal) >= 2000 and deptno in (10,20,30);
```

- 过滤条件有组函数时，必须声明在 having 中，例如 avg(sal)
- 过滤条件没有组函数时，建议声明在 where 中，例如 deptno（虽然可以在 having 中，但是效率不高）





SQL 执行顺序
---

```mysql
select 分组字段,组函数
from 表名 
	left join 次表 on 关联关系
	left join 次表 on 关联关系
where 过滤条件 
	and 过滤条件
group by 分组字段
having 分组之后过滤条件
order by 排序字段 asc,排序字段 desc
limit [偏移量,]查询行数
```

```mysql
(5) select 分组字段,组函数
(1) from 表名 
		left join 次表 on 关联关系
		left join 次表 on 关联关系
(2) where 过滤条件 
		and 过滤条件
(3) group by 分组字段
(4) having 分组之后过滤条件
(6) order by 排序字段 asc,排序字段 desc
(7) limit [偏移量,]查询行数
```

执行过程：

1. 先执行 from
2. 再执行 where
3. 再执行 group by
4. 再执行 having
5. ==执行 select==  再执行 distinct 
6. 再执行 order by
7. 再执行 limit

执行过程解析：

1. from 
	- 假如单表查询，那就是单表
	- 如果多表联查， `from 表1  left join 表2  on 关联条件` 
		- 先进行笛卡尔积，得到虚拟表（行数 = 表1的行数 * 表2的行数）以下称为 **笛卡尔表**（只是为了方便文字描述）
		- 进行 on 筛选，在 **笛卡尔表** 的基础上，得到虚拟表，以下称为 **内关联表**（只是为了方便文字描述） 
		- 再进行 left 或者 right 筛选，因为左外关联，右外关联会多出额外的行，在 **内关联表 **的基础上得到虚拟表，以下称为 **关联表**
		- 如果是 3 张表，前面两张表得到的 **关联表**，再与第 3 张表进行关联， 重复以上动作，得到虚拟表，以下还称为 **关联表**
2. where
	- 拿到 **关联表** 的数据，进行 where 条件过滤，得到虚拟表，以下称为 **符合条件表** （只是为了方便文字描述）
3. group by
	- 拿到 **符合条件表** 的数据，进行分组，得到虚拟表，以下称为 **分组表**（只是为了方便文字描述）
4. having
	- 拿到 **分组表** 的数据，再进行过滤，得到虚拟表表，以下称为 **分组过滤表**（只是为了方便文字描述）
	- 这也就是为什么 where 的效率会比 having 效率高
5. select
	- 完成了表关联，条件筛选，分组查询，分组过滤，提取表中的字段，进行 select
	- 先提取 select 的字段
	- 再 distinct 过滤掉重复行，得到虚拟表，以下称为 **select 表**（只是为了方便文字描述）
6. order by
	- 根据指定的字段排序，得到虚拟表，以下称为 **排序表**（只是为了方便文字描述）
7. limit
	- 在 **排序表** 的基础上，取出指定行的数据，得到 ==结果集==

