# MyISAM中索引B+树

## InnoDB 中的 B+树

<img src="https://attach.blog.wen7.online/20230312114529.png" alt="image-20220706000949682" style="zoom:80%;" />



## MyISAM中的 B+树

MyISAM 中的叶子结点数据是 ==用户数据的地址==，索引存放在 xxx.MYI 文件中，数据存放在 xxx.MYD 文件中

==MyISAM 中的索引也是非聚簇索引==，因为索引和数据是分离的

InnoDB 里的索引，主键建的索引是聚簇索引，如果是对非主键建的索引也是非聚簇索引

<img src="https://attach.blog.wen7.online/20230312134400.png" alt="image-20220706010510086" style="zoom:80%;" />

如果 MyISAM 对年龄字段做索引的话，数据是不用移动位置的，只需要再按照年龄创建一个 B+树，只不过叶子结点的数据（用户数据地址）会变化



## InnoDB 和 MyISAM 对比

### 是否聚簇

==InnoDB 至少有一个聚簇索引==，因为索引即数据，数据即索引，根据主键创建的聚簇索引，如果 InnoDB 对年龄列进行创建索引，创建的是非聚簇索引，因为数据只在主键 B+树上保存，会先查年龄 B+树，找到主键再查主键 B+树（==回表==）（偶尔也不需要回表：`select age from sys_user where age<18`）



==MyISAM 非聚簇索引==，数据和索引分开，必定回表



### 数据插入

如果 MyISAM 插入数据时（比如插入一条主键为 24 的数据），会直接在 xxx.MYD 插入最后，更新索引只要将最新数据的地址保存

如果 InnoDB 插入一条主键 id 为 24 的数据，为了保证主键递增，会移动数据行，很慢



### 主键

InnoDB 要求最好有主键（实际开发都会创建主键），如果没有主键，MySQL 会选择**非空且唯一**的列作为主键，如果连这样的列也不存在，MySQL 会生成一个隐含字段作为主键，该字段长整型，6字节



 